const wax=new waxjs.WaxJS({rpcEndpoint:"https://wax.greymass.com"});let transactionHash=null,generatedHash="";async function autoLogin(){var e;await wax.isAutoLoginAvailable()?(e=wax.userAccount,wax.pubKeys,e="AutoLogin enabled for account: "+e,document.getElementById("autologin").insertAdjacentHTML("beforeend",e),document.getElementById("button-logout").style.backgroundColor="orangered",document.getElementById("button-login").style.backgroundColor="lightblue",document.getElementById("button-sign-transaction").style.backgroundColor="limegreen",document.getElementById("response").textContent=""):document.getElementById("autologin").insertAdjacentHTML("beforeend","Not auto-logged in")}async function login(){if(!wax.api)try{var e=await wax.login(),t=wax.pubKeys,n="Account: "+e+"<br/>Active: "+t[0]+"<br/>Owner: "+t[1];document.getElementById("loginresponse").innerHTML=n,document.getElementById("button-logout").style.backgroundColor="orangered",document.getElementById("button-login").style.backgroundColor="lightblue",document.getElementById("button-sign-transaction").style.backgroundColor="limegreen",document.getElementById("response").textContent=""}catch(e){document.getElementById("loginresponse").innerHTML=e.message}}async function sign(){if(!wax.api)return document.getElementById("response").style.color="red",document.getElementById("response").append("* Login first *");document.getElementById("response").style.color="green",document.getElementById("response").textContent="Sending transaction...",document.getElementById("transactionHash").textContent="",document.getElementById("validationResult").textContent="";try{generatedHash=await getGeneratedHash(wax.userAccount),console.log("generatedHash",generatedHash);var e=await wax.api.transact({actions:[{account:"eosio.token",name:"transfer",authorization:[{actor:wax.userAccount,permission:"active"}],data:{from:wax.userAccount,to:"rizzlesizzle",quantity:"0.00000001 WAX",memo:generatedHash}}]},{blocksBehind:3,expireSeconds:30});transactionHash=e.transaction_id,document.getElementById("response").style.color="cornflowerblue",document.getElementById("response").textContent=JSON.stringify(e.processed.receipt.status,null,2),document.getElementById("transactionHash").textContent=transactionHash,document.getElementById("validationResult").textContent="Validating transaction...",await validateTransaction(transactionHash,wax.userAccount)}catch(e){document.getElementById("response").style.color="red",document.getElementById("response").textContent=e.message}}async function logout(){wax.api?(wax.logout(),document.getElementById("response").style.color="black",document.getElementById("response").textContent="* logged out from wax network *",document.getElementById("autologin").textContent="",document.getElementById("loginresponse").textContent="",document.getElementById("button-login").style.backgroundColor="orange",document.getElementById("button-logout").style.backgroundColor="lightblue",document.getElementById("button-sign-transaction").style.backgroundColor="lightblue"):(document.getElementById("response").style.color="red",document.getElementById("response").append("* Login first *"))}async function validateTransaction(e,t){try{var n,o=await fetch("http://localhost:8080/verifyTransaction",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transactionHash:e,generatedHash:generatedHash,userAccount:t})});if(!o.ok)throw n=await o.json(),new Error(n.error);var a=await o.json();console.log("Success:",a.message),document.getElementById("validationResult").textContent=a.message,document.getElementById("validationResult").append("<br>"+a.account)}catch(e){document.getElementById("validationResult").textContent="Error: "+e.message,console.error("Error:",e)}}async function getGeneratedHash(e){return await(await fetch("http://localhost:8080/hash?userAccount="+encodeURIComponent(e))).text()}autoLogin();